<template>
  <div class="content-block-cnt w-100 px-0 border-dark bg-primary" v-bind:class="{'border-top': borderTop, 'nopadding': noPadding, 'py-5': isCommunity == false}" :id="anchorpoint ? anchorpoint : ''">
    <div class="container-xl">
      <!-- icon (make sub-comp if accepted) -->

      <div ref="titlecnt" class="px-4 pt-4 px-lg-5 pt-lg-5 pb-0" v-if="title || subtext">
        <div class="title-stats-cnt">
          <h1 v-if="title" v-bind:class="[{ 'mb-0': !subtext }]">{{title}}</h1>
          <div class="title-stats-cnt mb-4">
            <span class="title-stats" v-if="isCommunity"><font-awesome-icon :icon="['fas', 'user']" />     {{ stats }}</span>
          </div>
        </div>
        <p v-if="subtext" class="lead">
          {{subtext}}
        </p>

        <div v-if="buttons">
          <template v-for="(button, index) in buttons">
            <vue-button
              :type="button.linkType"
              :url="button.url"
              :size="button.size"
              :title="button.title"
              :page="button.page"
              :anchorpoint="button.anchorpoint"
              :parentClasses="button.class"
            />
          </template>
        </div>
      </div>

      <!-- <hr v-if="bodyTextDivider && bodyText" class="my-0 mx-4 mx-lg-5 border-dark"> -->

      <div v-if="bodyText" class="p-4 p-lg-5">
        <div v-html="bodyText" class="wizywig">
        </div>
      </div>

      <template v-if="blockType != 'normal'">
        <!-- <hr v-if="dynamicContentDivider" class="my-0 mx-4 mx-lg-5 border-dark"> -->
        <component v-bind:is="blockType" :items="dynamicContent" :page="page" :name="title" :type="blockType"/>
      </template>

    </div>
  </div>
</template>

<script>
  import VueButton from '~/components/Button.vue'

  // Dynamic content
  import Gallery from '~/components/dynamic/Gallery.vue'
  import GalleryPage from '~/components/dynamic/GalleryPage.vue'
  import Instagram from '~/components/dynamic/Instagram.vue'
  import Guide from '~/components/dynamic/Guide.vue'
  import Tutorial from '~/components/dynamic/Tutorial.vue'
  import News from '~/components/dynamic/News.vue'
  import Events from '~/components/dynamic/CalendarCategory.vue'
  import Workshops from '~/components/dynamic/CalendarCategory.vue'
  import Exhibitions from '~/components/dynamic/CalendarCategory.vue'
  import GettingStarted from '~/components/dynamic/GettingStarted.vue'
  import KeyFeatures from '~/components/dynamic/KeyFeatures.vue'
  import Ecosystem from '~/components/dynamic/Ecosystem.vue'
  import Faq from '~/components/dynamic/FaQ.vue'

  export default {
    components: {
      VueButton,
      Gallery,
      GalleryPage,
      Instagram,
      Guide,
      Tutorial,
      News,
      Events,
      Workshops,
      Exhibitions,
      GettingStarted,
      KeyFeatures,
      Ecosystem,
      Faq
    },
    props: {
      initTitle: {
        type: String
      },
      initSubtext: {
        type: String
      },
      initBodyText: {
        type: String
      },
      initButtons: {
        type: Array
      },
      initAnchorpoint: {
        type: String
      },
      initType: {
        type: String
      },
      dynamicContent: {
        type: Array
      },
      page: {
        type: Object
      },
      initIndex: {
        type: Number
      }
    },
    data: function() {
      return {
        title: null,
        subtext: null,
        bodyText: null,
        bodyTextDivider: false,
        dynamicContentDivider: false,
        anchorpoint: null,
        blockType: 'normal',
        buttons: null,
        buttonClass: null,
        index: null,
        borderTop: true,
        noPadding: false,
        stats: '100 users',
        isCommunity: false
      }
    },
    mounted() {


      if(this.initIndex != undefined) {
        this.index = this.initIndex

        if(this.index == 0) {
          this.borderTop = false
          this.noPadding = true
        }
        if (this.initTitle == "Slack" || this.initTitle == "Github") {
          this.borderTop = false;
          this.noPadding = false;
        }
      }

      if(this.initTitle != undefined) {
        this.title = this.initTitle

        //////////////////////////////////////
        ////   STATS
        /////////////////////////////////////

        if(this.title == "Discourse forum") {
            this.isCommunity = true
            this.stats = "70+ users"
        } else if (this.title == "Slack") {
            this.isCommunity = true
            this.stats = "300+ members"
        } else if (this.title == "Github") {
            this.isCommunity = true
            this.stats = "20+ contributors"
        }
      }

      if(this.initSubtext != undefined) {
        this.subtext = this.initSubtext
      }

      if(this.initBodyText != undefined) {
        this.bodyText = this.initBodyText

        // Set state of divider above bodyText
        if(this.title || this.subtext || this.initButtons.length > 0) {
          this.bodyTextDivider = true
        }
      }

      if(this.initAnchorpoint != undefined) {
        this.anchorpoint = this.initAnchorpoint
      }

      if (this.initType != undefined) {
        this.blockType = this.initType
        
        if (this.blockType == "GettingStarted") this.isDark = true;
        if (this.blockType == "keyFeatures") this.isLight = true
      }

      // Set buttons array and classList for buttons
      if(this.initButtons != undefined) {
        if(this.initButtons.length > 0) {
          this.buttons = this.initButtons

          // Give spacing class if there are multiple buttons
          let buttonCounter = 1
          let self = this

          this.buttons.forEach(function(button, index) {
            if(buttonCounter < self.buttons.length) {
              button.class = 'mr-3'
            } else {
              button.class = ''
            }

            buttonCounter++
          })
        }
      }

      if(this.blockType != 'normal') {
        // Set state of divider above dynamic content
        if(this.title || this.subtext || this.bodyText || this.initButtons.length > 0) {
          this.dynamicContentDivider = true
        }
      }
    }
  }
</script>
<style>
.title-stats {
  margin-top: -30px;
}

.title-stats span {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 0.925rem
}

.nopadding {
  padding-top: 0 !important;
  padding-bottom: 0 !important
}

.icon {
  width: 40px;
  box-sizing: content-box;
  padding-left: 3rem;
}

</style>